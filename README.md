# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Товар

```
interface IItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

Пользователь

```
interface IUser extends IOrderForm, IContactsForm {
  payment: string;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[]
}
```

Данные для формы с адресом и выбором способа оплаты

```
interface IOrderForm {
  address?: string;
  selected?: string
}
```

Данные для формы с почтой и номером телефона

```
interface IContactsForm {
  email?: string;
  phone?: string;
}
```

Данные для окна успешной оплаты

```
interface IOrderResult {
  id: string;
  total: number;
}
```

Тип для ошибок валидации

```
type FormErrors = Partial<Record<keyof IUser, string>>;
```

Тип для товара, открывающегося в модальном окне просмотра (после клика по нему с главной страницы)

```
export type TItemModal = Omit<IItem, 'id'>;
```

Тип для товара, отображаемого в корзине

```
type TItemBasket = {
  index: string;
  title: string;
  price: string;
}
```


## Архитектура приложения

Код приложения разделен согласно парадигме MVP:
- слой представления, который отвечает за отображение данных на странице
- слой данных, который отвечает за хранение и изменение данных
- презентер, который отвечает за связь представления и данных

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах end-point и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на end-point, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом 'IEvents':
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Component
Класс предназначается для отображения элементов, классы которых наследуются от него.\
Основные методы:
- `toggleClass` - переключает класс элемента
- `setText` - установить текстовое значение для элемента
- `setDisabled` - меняет статус блокировки у элемента
- `setHidden` - скрыть элемент
- `setVisible` - проявить элемент
- `setImage` - установить изображение внутри элемента
- `render` - метод для отрисовки элемента на странице

### Слой данных

#### Класс AppState
Класс, отвечающий за состояние приложения. Содержит в себе основные данные всего приложения.\
Поля:
- basket: string[] - корзина, содержащая в себе массив с id товаров
- catalog: IItem[] - массив объектов товаров
- order: IUser - объект, который хранит данные пользователя
- formErrors: FormErrors = {} - пустой объект, который будет содержать в себе ошибки валидации

Класс имеет набор методов для взаимодействия с данными:
- `clearBasket()` - очищает данные пользователя (список выбранных товаров, контактные данные и тп)
- `getItem(itemId)` - получает данные конкретного товара с переданным id
- `getItems()` - получает данные всех товаров в каталоге
- `setCatalog(items)` - сохраняет переданные товары в каталоге и эмитирует событие `catalog:changed`
- `setPayment(payment)` - устанавливает способ оплаты
- `setAddress(address)` - устанавливает адрес
- `setEmail(email)` - устанавливает почту
- `setPhone(phone)` - устанавливает номер телефона
- `getTotal()` - получает стоимость товаров в корзине
- `setTotal(total)` - сохраняет стоимость товаров в корзине
- `getCounter()` - получает количество товаров в корзине
- `getOrder()` - получает данные заказа (пользователя)
- `addOrderItem(itemId)` - добавляет товар в заказ по переданному ID
- `deleteOrderItem(itemId)` - удаляет товар из заказа по переданному ID
- `setOrderField(field, value)` - устанавливает значение поля адреса. Если поле валидно, то генерирует событие `order:ready`.
- `validateOrder()` - проверяет поле адреса на валидность
- `setContactsField(field, value)` - устанавливает значение полей контактов. Если поля валидны, то генерирует событие `contacts:ready`.
- `validateContacts()` - проверяет поля контактов на валидность

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Отвечает за отображение каталога товаров на главной странице и за отображение счетчика количества товаров в корзине.\
В конструктор принимает контейнер и экземпляр `EventEmitter` для инициации событий.\
В полях класса содержится HTML-элемент корзины, HTML-элемент счетчика товаров в корзине, HTML-элемент каталога товаров, а так же HTML-элемент обертки для блокировки скролла.\
При клике по кнопке иконки генерируется событие `basket:open`.\
Класс имеет сеттеры для полей.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатель на клик в оверлей и кнопку-крестик для закрытия попапа. Конструктор принимает контейнер и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- closeButtonModal: HTMLButtonElement - кнопка закрытия модального окна
- contentModal: HTMLElement - контент модального окна

Методы:
- `open()` - открыть модальное окно
- `close()` - закрыть модальное окно
- `render(data)` - отрисовать модальное окно с переданными данными

Так же имеется сеттер для поля контента.

#### Абстрактный класс Form
Отвечает за отображение полей ввода в модальных окнах. Контструктор принимает контейнер и экземпляр `EventEmitter`. Реализует интерфейс IFormState:

```
interface IFormState {
    valid: boolean - валидность
    errors: string[] - массив ошибок
}
```

Поля класса:
- submit: HTMLButtonElement
- errors: HTMLElement

Имеет сеттеры на для `valid` и `errors`.

Методы:
- `render(state)`

#### Класс Order
Дочерний класс Form. Соответствует форме для заполнения адреса доставки.\
Имеет поле `buttons: HTMLButtonElement[]` - массив кнопок для выбора способа оплаты.
Сеттеры на `address` и `selected`, а так же геттер для `address`.

#### Класс FormContacts
Дочерний класс Form. Соответствует форме для заполнения контактных данных.
Имеет сеттеры для почты, телефона и геттеры для них.

#### Класс Basket
Отвечает за отображение списка товаров, выбранных пользователем, в корзине. Реализует интерфейс IBasket:
```
interface IBasket {
    items: HTMLElement[] - массив товаров в корзине
    total: number - общая стоимость товаров
}
```
В конструктор принимает контейнер и экземпляр `EventEmitter` для инициации событий.\

Поля класса:
- `itemsList` - список товаров в корзине
- `basketTotal` - общая цена всех товаров в корзине
- `orderButton` - кнопка "Оформить"
- `basketParagraph` - сообщение, что корзина пустая, которое исчезает при добавлении товаров в корзину

Класс имеет сеттеры для полей `items` и `total`.

#### Класс Success
Отвечает за отображение сообщения об успешном сохранении заказа на сервере.
В конструктор принимает контейнер и экземпляр `EventEmitter`.\
Класс реализует интерфейс ISuccess:
```
interface ISuccess {
    total: number - общая цена товаров в корзине
}
```
Поля класса:
- closeButton: HTMLElement - кнопка закрытия
- _total: HTMLElement - общая стоимость товаров

Имеет сеттер для `total`.

#### Класс Card
Отвечает за отображение карточки товара на главной странице, задавая данные (категорию, название, изображение, цену). В конструктор принимает контейнер.

Поля класса:
- `cardId` - ID товара
- `cardTitle` - заголовок карточки
- `cardCategory` - категория карточки
- `cardImage` - изображение карточки
- `cardPrice` - цена товара на карточке

Методы:
- сеттеры на `title`, `category`, `image`, `price`, `id`

#### Класс CardModal
Отвечает за отображение карточки в модальном окне, наследуется от класса `Card`.
Имеет поля:
- `cardButton` - кнопка на карточке
- `cardDescription` - детальное описание карточки

На кнопке стоит слушатель событий, который по клику генерирует событие `item:added`, либо `item:deleted`.

Имеет сеттеры на поля `description` и `price`.

#### Класс CardBasket
Отвечает за отображение карточки в корзине.
Имеет поля:
- `cardId` - ID товара
- `cardTitle` - заголовок карточки
- `cardPrice` - цена товара
- `cardIndex` - порядковый номер карточки в корзине
- `deleteButton` - кнопка удаления товара из корзины

На кнопке удаления стоит слушатель, который по клику генерирует событие `item:deleted`.

Имеет сеттеры на `id`, `index`, `title`, `price`.

### Слой коммуникации

#### Класс LarekAPI
Класс наследуется от класса Api и содержит в себе методы для получения данных от сервера.
Методы:
- `getItemList()` - получить список всех товаров
- `orderItems(order)` - оформить заказ товаров

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список всех событий, которые могут генерироваться в системе:\
*События изменения данных:*
- `catalog:changed` - изменение данных каталога товаров

*События, возникающие при взаимодействии пользователя с интерфейсом:*
- `basket:open` - открыта корзина
- `item:added` - добавлен товар в корзину
- `item:deleted` - удален товар из корзины
- `basket:submit` - нажата кнопка оформления заказа в корзине
- `tab:selected` - выбран способ оплаты
- `order:submit` - нажата кнопка "Далее" в форме заполнения адреса
- `contacts:submit` - нажата кнопка "Оплатить" в форме заполнения почты и телефона
- `success:close` - нажата кнопка "За новыми покупками!" в модальном окне успешной оплаты
- `orderFormErrors:change` - ошибка валидации в форме заполнения адреса
- `contactsFormErrors:change` - ошибка валидации в форме заполнения почты и телефона
- `order:change` - изменение поля ввода адреса
- `contacts:change` - изменение полей ввода почты и телефона
- `modal:open` - открыто модальное окно
- `modal:close` - закрыто модальное окно